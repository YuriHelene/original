<%# 投稿一覧ページ %>
<%= stylesheet_link_tag 'index', :media => "all" %>

<%# <%= button_to 'ログアウト', destroy_user_session_path, method: :delete %> 
<div class=else>
<h3>投稿一覧</h3>

<%# <% if user_signed_in? %>
  <%# <%= link_to "マイページへ", user_path(current_user.id) %>
<%# <% end %>

<%# <h4>投稿を検索</h4> %>
<%= form_tag({controller:"tweets",action:"index"}, method: :get) do %>
  <%= text_field_tag :search %>
  <%= submit_tag '検索する' ,class: "button-search" %>
<% end %>

<div class="sort-form">
  <%= form_with url: tweets_path, method: :get, local: true do %>
    <label for="sort">並び替え：</label>
    <%= select_tag :sort,
        options_for_select([
          ['新しい順', 'new'],
          ['古い順', 'old'],
          ['いいね順', 'likes']
        ], selected: params[:sort]),
        onchange: 'this.form.submit();' %>
  <% end %>
</div>
</div>

<div class="main-box">
  <div class="left-container">
  <div class="tweets-container">
    <% @tweets.each do |t| %>
    <div class="tweet-card">

  <b><%= t.title %></b>
  <p><%= simple_format(t.body) %></p>
      <% if t.image.attached? %>
        <%= image_tag t.image.variant(resize_to_limit: [250, 200]), size: '250x200' %>
        <%# 4/19 16:32 エラー解消のため %>
            <%# <%= image_tag t.image, size: '250x200'%>
      <% end %>

    <% if user_signed_in? %>
      <% if current_user.already_liked?(t) %>
          <%= button_to tweet_like_path(id: t.id, tweet_id: t.id), method: :delete,class: 'likes' do %>
            <%= image_tag asset_path('heart_likes.png'), class: 'heart_likes' %>
              <%# <p>いいねを取り消す</p> %>
              <%= t.likes.count %>
          <% end %>
        <% else %>
          <%= button_to tweet_likes_path(id: t.id, tweet_id: t.id), method: :post,class: 'likes' do %>
            <%= image_tag asset_path('heart_pre.png'), class: 'heart_likes' %>
              <%# <p>いいね</p> %>
              <%= t.likes.count %>
        <% end %>
      <% end %>
  <% else %>
      <p>いいねの数 = <%= t.likes.count %></p>
  <% end %>
    
      <%= link_to t.user.name, user_path(t.user.id) %>
      <%# <%= t.user.email %> 
      <%= t.created_at.strftime('%Y/%m/%d %H:%M:%S') %>
      <%= link_to "投稿詳細へ", tweet_path(t.id) %> 
      
      <% if user_signed_in? && current_user.id == t.user_id %>
      <%= link_to "編集する", edit_tweet_path(t.id) %>
      <%# <%= link_to "削除する", tweet_path(t.id), method: :delete, data: { confirm: "本当に削除しますか？", turbo: false } %>
      <%# <%= link_to "削除する", tweet_path(t.id), method: :delete %> 
      <%# <%= link_to "削除する", tweet_path(t.id), data: { turbo_method: :delete } %> 
    <% end %> 
  </div>
  <% end %>
  </div>
  </div>

<%# <%= page_entries_info @tweets %> 
<%= paginate @tweets %>

<span id="top-btn">
    <a href="#">
      <%= image_tag asset_path('top.btn.png'), class: 'top-btn' %>
    </a>
</span>
<%# ページ上部に戻るボタン %>
</div>